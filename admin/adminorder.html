<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Orders</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 text-gray-900">

<!-- HEADER -->
<header class="bg-red-600 text-white p-4 text-center text-xl font-bold shadow">
  Admin - All Orders
</header>

<main class="max-w-7xl mx-auto p-6">

  <!-- CONTROLS -->
  <div class="flex flex-col sm:flex-row gap-4 mb-6">
    <input
      id="searchInput"
      placeholder="Search Order ID or Customer Name"
      class="flex-1 border rounded-lg p-2"
      oninput="renderOrders()"
    />

    <select id="statusFilter" class="border rounded-lg p-2" onchange="renderOrders()">
      <option value="all">All Status</option>
      <option value="Pending">Pending</option>
      <option value="Paid">Paid</option>
      <option value="Shipped">Shipped</option>
      <option value="Cancelled">Cancelled</option>
    </select>
  </div>

  <!-- ORDERS -->
  <div id="ordersList" class="space-y-6"></div>

</main>

<script>
const ordersList = document.getElementById("ordersList");
const searchInput = document.getElementById("searchInput");
const statusFilter = document.getElementById("statusFilter");

let orders = JSON.parse(localStorage.getItem("orders")) || [];

/* UPDATE STATUS */
function updateOrderStatus(orderId, status) {
  const order = orders.find(o => o.id === orderId);
  if (!order) return;
  order.status = status;
  localStorage.setItem("orders", JSON.stringify(orders));
  renderOrders();
}

/* DELETE */
function deleteOrder(orderId) {
  if (!confirm("Delete this order?")) return;
  orders = orders.filter(o => o.id !== orderId);
  localStorage.setItem("orders", JSON.stringify(orders));
  renderOrders();
}

/* RENDER */
function renderOrders() {
  ordersList.innerHTML = "";

  let filtered = [...orders].reverse();

  const search = searchInput.value.toLowerCase();
  if (search) {
    filtered = filtered.filter(o =>
      String(o.id).includes(search) ||
      o.shipping.name.toLowerCase().includes(search)
    );
  }

  const status = statusFilter.value;
  if (status !== "all") {
    filtered = filtered.filter(o => o.status === status);
  }

  if (filtered.length === 0) {
    ordersList.innerHTML = `<p class="text-center text-gray-500">No orders found.</p>`;
    return;
  }

  filtered.forEach(order => {
    const statusColor = {
      Pending: "text-yellow-600",
      Paid: "text-green-600",
      Shipped: "text-blue-600",
      Cancelled: "text-red-600"
    }[order.status] || "text-gray-600";

    let itemsHTML = "";
    const grouped = {};
    order.items.forEach(item => {
      if (!grouped[item.id]) grouped[item.id] = { ...item, qty: 0 };
      grouped[item.id].qty++;
    });

    Object.values(grouped).forEach(item => {
      itemsHTML += `
        <div class="flex items-center justify-between text-sm">
          <div class="flex items-center gap-3">
            <img src="${item.imgLocal || item.img || 'https://via.placeholder.com/50'}"
                 class="w-10 h-10 rounded object-cover">
            <span>${item.title} Ã— ${item.qty}</span>
          </div>
          <span>$${(item.price * item.qty).toFixed(2)}</span>
        </div>
      `;
    });

    ordersList.innerHTML += `
      <div class="bg-white rounded-2xl shadow p-5 border-l-4 ${order.status === 'Paid' ? 'border-green-500' : 'border-yellow-500'}">

        <div class="flex justify-between items-center mb-2">
          <h3 class="font-bold">Order #${order.id}</h3>
          <span class="text-sm text-gray-500">${order.date}</span>
        </div>

        <div class="space-y-1 mb-3">${itemsHTML}</div>

        <p class="font-semibold mb-1">Total: $${order.total.toFixed(2)}</p>

        <p class="text-sm text-gray-600">
          ${order.shipping.name}, ${order.shipping.address}, ${order.shipping.city} (${order.shipping.zip})
        </p>

        <div class="flex flex-wrap items-center gap-4 mt-3">
          <span class="text-sm">Payment: <b>${order.payment.toUpperCase()}</b></span>

          <select
            class="border rounded px-2 py-1 font-semibold ${statusColor}"
            onchange="updateOrderStatus(${order.id}, this.value)">
            <option ${order.status === "Pending" && "selected"}>Pending</option>
            <option ${order.status === "Paid" && "selected"}>Paid</option>
            <option ${order.status === "Shipped" && "selected"}>Shipped</option>
            <option ${order.status === "Cancelled" && "selected"}>Cancelled</option>
          </select>

          <button
            onclick="deleteOrder(${order.id})"
            class="ml-auto bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm">
            Delete
          </button>
        </div>

      </div>
    `;
  });
}

renderOrders();
</script>

</body>
</html>
